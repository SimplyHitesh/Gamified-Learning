// Question bank (paste your full questionBank object here)
const questionBank = {
  "6": {
    "science": [
      {
        question: "What is the process by which plants make their own food?",
        options: ["Photosynthesis", "Respiration", "Transpiration"],
        answer: "Photosynthesis"
      },
      {
        question: "Which gas do plants absorb from the air?",
        options: ["Oxygen", "Carbon dioxide", "Nitrogen"],
        answer: "Carbon dioxide"
      },
      {
        question: "What part of the plant conducts photosynthesis?",
        options: ["Roots", "Leaves", "Stem"],
        answer: "Leaves"
      },
      {
        question: "What is the boiling point of water?",
        options: ["100°C", "0°C", "50°C"],
        answer: "100°C"
      },
      {
        question: "Which organ pumps blood throughout the body?",
        options: ["Lungs", "Heart", "Brain"],
        answer: "Heart"
      }
    ],
    "history": [
      {
        question: "Who was the first President of the United States?",
        options: ["George Washington", "Thomas Jefferson", "Abraham Lincoln"],
        answer: "George Washington"
      },
      {
        question: "Which ancient civilization built the pyramids?",
        options: ["Romans", "Egyptians", "Greeks"],
        answer: "Egyptians"
      },
      {
        question: "Who discovered America in 1492?",
        options: ["Christopher Columbus", "Marco Polo", "Vasco da Gama"],
        answer: "Christopher Columbus"
      },
      {
        question: "What was the name of the ship on which the Pilgrims traveled to America?",
        options: ["Mayflower", "Santa Maria", "Endeavour"],
        answer: "Mayflower"
      },
      {
        question: "Who was known as the 'Mahatma'?",
        options: ["Jawaharlal Nehru", "Mahatma Gandhi", "Subhas Chandra Bose"],
        answer: "Mahatma Gandhi"
      }
    ],
    "sports": [
      {
        question: "How many players are there in a football team?",
        options: ["9", "11", "7"],
        answer: "11"
      },
      {
        question: "Which sport uses a shuttlecock?",
        options: ["Tennis", "Badminton", "Squash"],
        answer: "Badminton"
      },
      {
        question: "How many rings are there in the Olympic flag?",
        options: ["4", "5", "6"],
        answer: "5"
      },
      {
        question: "Which country won the FIFA World Cup in 2018?",
        options: ["Brazil", "France", "Germany"],
        answer: "France"
      },
      {
        question: "What sport is known as the 'king of sports'?",
        options: ["Cricket", "Football", "Basketball"],
        answer: "Football"
      }
    ]
  },
  "7": {
    "science": [
      {
        question: "What is the chemical symbol for water?",
        options: ["H2O", "O2", "CO2"],
        answer: "H2O"
      },
      {
        question: "Which planet is known as the Red Planet?",
        options: ["Mars", "Venus", "Jupiter"],
        answer: "Mars"
      },
      {
        question: "What force keeps us on the ground?",
        options: ["Magnetism", "Gravity", "Friction"],
        answer: "Gravity"
      },
      {
        question: "What gas do humans breathe in to survive?",
        options: ["Oxygen", "Carbon dioxide", "Nitrogen"],
        answer: "Oxygen"
      },
      {
        question: "Which organ is responsible for filtering blood?",
        options: ["Liver", "Kidneys", "Heart"],
        answer: "Kidneys"
      }
    ],
    "history": [
      {
        question: "Who was the first Prime Minister of India?",
        options: ["Jawaharlal Nehru", "Indira Gandhi", "Rajendra Prasad"],
        answer: "Jawaharlal Nehru"
      },
      {
        question: "In which year did India gain independence?",
        options: ["1947", "1950", "1935"],
        answer: "1947"
      },
      {
        question: "Who wrote the Indian national anthem?",
        options: ["Rabindranath Tagore", "Bankim Chandra Chatterjee", "Sarojini Naidu"],
        answer: "Rabindranath Tagore"
      },
      {
        question: "Which empire was ruled by Akbar?",
        options: ["Mughal Empire", "Maurya Empire", "Gupta Empire"],
        answer: "Mughal Empire"
      },
      {
        question: "Who was the leader of the Salt March?",
        options: ["Mahatma Gandhi", "Jawaharlal Nehru", "Sardar Patel"],
        answer: "Mahatma Gandhi"
      }
    ],
    "sports": [
      {
        question: "How many players are there in a basketball team on the court?",
        options: ["5", "7", "6"],
        answer: "5"
      },
      {
        question: "Which sport is played on a pitch?",
        options: ["Cricket", "Tennis", "Football"],
        answer: "Cricket"
      },
      {
        question: "Who holds the record for most Olympic gold medals?",
        options: ["Michael Phelps", "Usain Bolt", "Carl Lewis"],
        answer: "Michael Phelps"
      },
      {
        question: "What is the length of a marathon?",
        options: ["26.2 miles", "10 miles", "42 km"],
        answer: "26.2 miles"
      },
      {
        question: "Which country invented table tennis?",
        options: ["England", "China", "USA"],
        answer: "England"
      }
    ]
  },
  "8": {
    "science": [
      {
        question: "What is the powerhouse of the cell?",
        options: ["Nucleus", "Mitochondria", "Ribosome"],
        answer: "Mitochondria"
      },
      {
        question: "What is the chemical formula for salt?",
        options: ["NaCl", "KCl", "CaCl2"],
        answer: "NaCl"
      },
      {
        question: "Which gas is most abundant in the Earth's atmosphere?",
        options: ["Oxygen", "Nitrogen", "Carbon dioxide"],
        answer: "Nitrogen"
      },
      {
        question: "What type of energy is stored in food?",
        options: ["Kinetic energy", "Chemical energy", "Thermal energy"],
        answer: "Chemical energy"
      },
      {
        question: "What is the process of cell division called?",
        options: ["Mitosis", "Meiosis", "Photosynthesis"],
        answer: "Mitosis"
      }
    ],
    "history": [
      {
        question: "Who was the last Mughal emperor?",
        options: ["Bahadur Shah II", "Akbar", "Shah Jahan"],
        answer: "Bahadur Shah II"
      },
      {
        question: "Which war was fought between the North and South regions of the USA?",
        options: ["World War I", "Civil War", "Revolutionary War"],
        answer: "Civil War"
      },
      {
        question: "Who was the famous civil rights leader who gave the 'I Have a Dream' speech?",
        options: ["Martin Luther King Jr.", "Malcolm X", "Nelson Mandela"],
        answer: "Martin Luther King Jr."
      },
      {
        question: "When did World War II end?",
        options: ["1945", "1939", "1918"],
        answer: "1945"
      },
      {
        question: "Who was the first man to walk on the moon?",
        options: ["Neil Armstrong", "Buzz Aldrin", "Yuri Gagarin"],
        answer: "Neil Armstrong"
      }
    ],
    "sports": [
      {
        question: "Which country won the FIFA World Cup in 2014?",
        options: ["Germany", "Brazil", "Argentina"],
        answer: "Germany"
      },
      {
        question: "How many players are on a volleyball team on the court?",
        options: ["6", "5", "7"],
        answer: "6"
      },
      {
        question: "What is the term for scoring three goals in a single soccer match?",
        options: ["Hat-trick", "Triple", "Goal rush"],
        answer: "Hat-trick"
      },
      {
        question: "Which sport uses a puck?",
        options: ["Ice hockey", "Field hockey", "Lacrosse"],
        answer: "Ice hockey"
      },
      {
        question: "Who holds the record for the fastest 100m sprint?",
        options: ["Usain Bolt", "Carl Lewis", "Justin Gatlin"],
        answer: "Usain Bolt"
      }
    ]
  }
};

let selectedClass = null;
let selectedTopic = null;
let currentQuestionIndex = 0;
let selectedQuestions = [];
let score = 0;
let timer = null;
const QUESTION_TIME = 15; // seconds
let timeLeft = QUESTION_TIME;
let wrongAttempts = 0; // Track wrong attempts per question

// DOM Elements
const classSelectionDiv = document.getElementById("class-selection");
const topicSelectionDiv = document.getElementById("topic-selection");
const quizContainer = document.getElementById("quiz-container");
const questionEl = document.getElementById("question");
const optionsDiv = document.getElementById("options");
const resultEl = document.getElementById("result");
const progressBar = document.getElementById("progressBar");

// --- TIMER DISPLAY ---
let timerEl = document.getElementById("timer");
if (!timerEl) {
  timerEl = document.createElement("div");
  timerEl.id = "timer";
  timerEl.style.fontSize = "1.2em";
  timerEl.style.marginBottom = "10px";
  timerEl.style.color = "#08fdd8";
  quizContainer.insertBefore(timerEl, questionEl);
}

// Step 1: Select Class
document.querySelectorAll(".class-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    selectedClass = btn.getAttribute("data-class");
    classSelectionDiv.style.display = "none";
    topicSelectionDiv.style.display = "block";
  });
});

// Step 2: Select Topic
document.querySelectorAll(".topic-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    selectedTopic = btn.getAttribute("data-topic");
    topicSelectionDiv.style.display = "none";
    quizContainer.style.display = "block";
    score = 0;
    loadQuestions();
    showQuestion();
  });
});

function loadQuestions() {
  if (!selectedClass || !selectedTopic) return;
  const questionsForSelection = questionBank[selectedClass][selectedTopic];
  selectedQuestions = shuffleArray([...questionsForSelection]);
  currentQuestionIndex = 0;
}

function showQuestion() {
  clearInterval(timer);
  wrongAttempts = 0; // Reset wrong attempts for new question

  if (currentQuestionIndex >= selectedQuestions.length) {
    questionEl.textContent = `🎉 Quiz completed! Your score: ${score} / ${selectedQuestions.length * QUESTION_TIME}`;
    optionsDiv.innerHTML = "";
    resultEl.textContent = "";
    progressBar.style.width = "100%";
    timerEl.textContent = "";
    return;
  }

  const currentQuestion = selectedQuestions[currentQuestionIndex];
  questionEl.textContent = currentQuestion.question;

  // Animate question fade-in
  questionEl.style.opacity = "0";
  setTimeout(() => {
    questionEl.style.animation = "fadeInUp 0.8s ease forwards";
  }, 10);

  optionsDiv.innerHTML = "";

  currentQuestion.options.forEach((option, index) => {
    const button = document.createElement("button");
    button.textContent = option;
    button.onclick = () => checkAnswer(option);
    button.style.opacity = "0";
    button.style.animation = `fadeInUp 1s ease forwards`;
    button.style.animationDelay = `${0.2 + index * 0.2}s`;
    optionsDiv.appendChild(button);
  });

  resultEl.textContent = "";
  resultEl.style.opacity = "0";

  timeLeft = QUESTION_TIME;
  updateTimerDisplay();
  startTimer();
  updateProgressBar();
}

function startTimer() {
  clearInterval(timer);
  timer = setInterval(() => {
    timeLeft--;
    updateTimerDisplay();
    if (timeLeft <= 0) {
      clearInterval(timer);
      resultEl.textContent = `⏰ Time's up! The correct answer was: ${selectedQuestions[currentQuestionIndex].answer}`;
      resultEl.style.color = "red";
      currentQuestionIndex++;
      setTimeout(() => {
        resultEl.textContent = "";
        showQuestion();
      }, 2000);
    }
  }, 1000);
}

function updateTimerDisplay() {
  timerEl.textContent = `Time left: ${timeLeft}s`;
}
function checkAnswer(selectedOption) {
  const currentQuestion = selectedQuestions[currentQuestionIndex];

  if (selectedOption === currentQuestion.answer) {
    clearInterval(timer); // Stop timer only on correct answer

    // Calculate points with penalty for wrong attempts
    const maxPoints = timeLeft;
    const penalty = wrongAttempts * 5;
    const points = Math.max(maxPoints - penalty, 0);

    score += points;
    resultEl.textContent = `✅ Correct! +${points} points`;
    resultEl.style.color = "#08fdd8";
    resultEl.style.animation = "fadeInResult 0.5s forwards";
    currentQuestionIndex++;
    setTimeout(() => {
      resultEl.style.animation = "fadeOutResult 0.5s forwards";
      setTimeout(() => {
        showQuestion();
      }, 500);
    }, 1000);
  } else {
    wrongAttempts++;
    resultEl.textContent = `❌ Wrong! Try Again!`;
    resultEl.style.color = "red";
    resultEl.style.animation = "fadeInResult 0.5s forwards";
    setTimeout(() => {
      resultEl.style.animation = "fadeOutResult 0.5s forwards";
    }, 1500);
    // Timer keeps running; no clearInterval here
  }
}


function updateProgressBar() {
  const progress = (currentQuestionIndex / selectedQuestions.length) * 100;
  progressBar.style.width = progress + "%";
}

function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}
